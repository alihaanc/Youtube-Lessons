/*
 * FIR.c
 *
 *  Created on: Nov 14, 2025
 *      Author: aliha
 */


#include "FIR.h"




#ifdef EXAMPLE_1


#define M 8
#define n  M-1


float h[M]= {0.1f, 0.15f, 0.2f, 0.1f, 0.1f, 0.1f, 0.1f, 0.15f};
float x[M] ={0.23f, 0.135f, 0.42f, 0.15f, 0.1332f, 0.112f, 0.123f, 0.1235f};

float fir_apply(){

	float y_n = 0.0f;

	for (uint8_t k = 0; k < M; ++k) {

		y_n += h[k] * x[ n  - k ];

}

	/*    float res = 0.0f;

    res  = h[0] * x[7];
    res += h[1] * x[6];
    res += h[2] * x[5];
    res += h[3] * x[4];
    res += h[4] * x[3];
    res += h[5] * x[2];
    res += h[6] * x[1];
    res += h[7] * x[0];*/

	return y_n;
}
#endif//1



#ifdef EXAMPLE_2

//50khz fir
ALIGN_32B float FIRCoeff[LENGTH] = {

			0.03424170292357537500,
	        0.03469467109575672500,
	        0.03514663065246652300,
	        0.03559741330950042700,
	        0.03604684510957892300,
	        0.03649474530561866400,
	        0.03694094309377573400,
	        0.03738534654014880100,
	        0.03782804426194642800,
	        0.03826901520402514700,
	        0.03870564348511224000,
	        0.03912318427367868900,
	        0.03946945139539265200,
	        0.04011272669884691900,
	        0.03946945139539265200,
	        0.03912318427367868900,
	        0.03870564348511224000,
	        0.03826901520402514700,
	        0.03782804426194642800,
	        0.03738534654014880100,
	        0.03694094309377573400,
	        0.03649474530561866400,
	        0.03604684510957892300,
	        0.03559741330950042700,
	        0.03514663065246652300,
	        0.03469467109575672500,
	        0.034241702923575375004
};
//41 tap
//ALIGN_32B float FIRCoeff[LENGTH] = {
//        0.00587597495141835550,
//		0.00772163160803012670, 0.00967057336813432340, 0.01170513460027065300,
//		0.01380561034787575500, 0.01595051756402209400, 0.01811689683798763800,
//		0.02028064950937857200, 0.02241690420649797600, 0.02450040610633642100,
//		0.02650592161311308300, 0.02840865070672868700, 0.03018463893422732700,
//		0.03181118091487120100, 0.03326720730700890400, 0.03453364744250100900,
//		0.03559376026764516500, 0.03643342682960126800, 0.03704139830145188100,
//		0.03740949443063348900, 0.03753274830453267500, 0.03740949443063348900,
//		0.03704139830145188100, 0.03643342682960126800, 0.03559376026764516500,
//		0.03453364744250100900, 0.03326720730700890400, 0.03181118091487120100,
//		0.03018463893422732700, 0.02840865070672868700, 0.02650592161311308300,
//		0.02450040610633642100, 0.02241690420649797600, 0.02028064950937857200,
//		0.01811689683798763800, 0.01595051756402209400, 0.01380561034787575500,
//		0.01170513460027065300, 0.00967057336813432340, 0.00772163160803012670,
//		0.00587597495141835550
//};

void fir_apply(FIR_t *filt, float Src) {

    unsigned int tempIndex = filt->filt_head;
    unsigned int n;


    filt->buf[filt->filt_head] = Src;


    filt->filt_head = (filt->filt_head + 1) % LENGTH;


    filt->output_f = 0.0f;


    for (n = 0; n < LENGTH; n++) {

        switch (tempIndex) {
			case 0:
				tempIndex  = LENGTH - 1;
				break;
			default:
				tempIndex -=  1;
				break;
		}
        filt->output_f += FIRCoeff[n] * filt->buf[tempIndex];
    }
}


#endif


#ifdef EXAMPLE_3
float fir_apply(FIR31_t * fir_t ,float source){



}
#endif
